

  <!-- Loading State -->
<div *ngIf="loading" class="loading-container" style="display: flex; justify-content: center; align-items: center; min-height: 400px;">
  <div style="text-align: center;">
    <p>Loading quotation data...</p>
  </div>
</div>

<!-- Error State -->
<div *ngIf="!loading && error" class="error-container" style="display: flex; justify-content: center; align-items: center; min-height: 400px;">
  <div style="text-align: center; color: #e74c3c;">
    <p>{{ error }}</p>
  </div>
</div>

<!-- Document Content -->
<div class="document-wrapper" *ngIf="!loading && !error && quoteData">
  <!-- Use table layout for reliable repeating footer in print -->
  <table class="print-table">
    <tbody>
      <tr>
        <td class="print-body">
          <div class="document-page">
            <div class="page-content">
              <!-- Company Header Image -->
              <div class="company-header">
                <img src="assets/pdfheaderimage.png" alt="Indo Shell Cast Private Limited" class="header-image">
              </div>

              <!-- Quote Reference Section -->
              <div class="quote-reference-section">
                <div class="quote-ref-item">
                  <span class="quote-label" [innerHTML]="boldBeforeColon(quoteData.header.quoteRefNumber.label || '')"></span>
                  <span class="quote-value" [innerHTML]="boldBeforeColon(quoteData.header.quoteRefNumber.value || '-')"></span> &nbsp;&nbsp;
                  <span class="quote-label" [innerHTML]="boldBeforeColon(quoteData.header.date.label || 'Date:')"></span>
                  <span class="quote-value" [innerHTML]="boldBeforeColon(quoteData.header.date.value || '-')"></span>
                </div>
                <div class="quote-ref-item">
                  <span class="quote-label" [innerHTML]="boldBeforeColon(quoteData.header.customer.label || '')"></span>
                  <span class="quote-value" [innerHTML]="boldBeforeColon(quoteData.header.customer.value || '-')"></span>
                </div>
              </div>

              <!-- Header Section -->
              <div class="document-header">
                <div class="attention-line">
                  <span class="attention-label" [innerHTML]="boldBeforeColon(quoteData.header.attention.label || '')"></span>
                  <span class="attention-value" [innerHTML]="boldBeforeColon(quoteData.header.attention.value || '-')"></span>
                </div>
                <div class="greeting" [innerHTML]="boldBeforeColon(quoteData.salutation || 'Dear Sir,')"></div>
                <div class="intro-paragraph" [innerHTML]="boldBeforeColon(quoteData.introduction || '')"></div>
              </div>

              <!-- Main Quote Table -->
              <div class="quote-table-section">
                <table class="main-quote-table">
                  <thead>
                    <tr>
                      <th colspan="9" class="table-main-title"
                          [innerHTML]="boldBeforeColon(quoteData.quoteTable.title || 'ISC – SHELL MOULDING/ STEEL CASTING – QUOTE')">
                      </th>
                    </tr>
                    <tr>
                      <th>{{ getColumnHeader('sno') }}</th>
                      <th>{{ getColumnHeader('drawingNumber') }}</th>
                      <th>{{ getColumnHeader('partName') }}</th>
                      <th>{{ getColumnHeader('castingMaterial') }}</th>
                      <th>{{ getColumnHeader('castingWeightInKgs') }}</th>
                      <th>{{ getColumnHeader('annualVolume') }}</th>
                      <th>{{ getColumnHeader('partPriceInINR') }}</th>
                      <th class="pattern-cost-header">
                        <div class="pattern-cost-title">{{ getColumnHeader('patternCostINR') }}</div>
                        <div class="pattern-cost-line"></div>
                      </th>
                      <th>{{ getColumnHeader('moqInNos') }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Your existing table rows -->
                    <ng-container *ngIf="getTableRows().length > 0">
                      <ng-container *ngFor="let row of getTableRows(); let i = index">
                        <tr>
                          <td [attr.rowspan]="getRowSpan(i)" class="sno-cell">{{ getSno(i) }}</td>
                          <td [attr.rowspan]="getRowSpan(i)" class="drawing-number-cell">{{ getDrawingNumber(i) }}</td>
                          <td [attr.rowspan]="getRowSpan(i)" class="part-name-cell">
                            <div class="multi-line-text">{{ formatPartName(getPartName(i)) || '-' }}</div>
                          </td>
                          <td [attr.rowspan]="getRowSpan(i)" class="material-cell">
                            <div class="multi-line-text">{{ formatCastingMaterial(isColumnsArray() ? getRowValue(row, 'castingMaterial') : (row.castingMaterial || '-')) || '-' }}</div>
                          </td>
                          <td [attr.rowspan]="getRowSpan(i)" class="data-cell">{{ isColumnsArray() ? getRowValue(row, 'castingWeightInKgs') : (row.castingWeight || '-') }}</td>
                          <td [attr.rowspan]="getRowSpan(i)" class="data-cell">{{ isColumnsArray() ? getRowValue(row, 'annualVolume') : (row.annualVolume || '-') }}</td>
                          <td [attr.rowspan]="getRowSpan(i)" class="data-cell">{{ isColumnsArray() ? getRowValue(row, 'partPriceInINR') : (row.partPrice || '-') }}</td>
                          <td [attr.rowspan]="getRowSpan(i)" class="data-cell">{{ isColumnsArray() ? getRowValue(row, 'patternCostINR') : (row.patternCost || '-') }}</td>
                          <td [attr.rowspan]="getRowSpan(i)" class="data-cell">{{ isColumnsArray() ? getRowValue(row, 'moqInNos') : (row.moq || '-') }}</td>
                        </tr>
                        <tr *ngFor="let emptyRow of getEmptyRows(i)"></tr>
                      </ng-container>
                    </ng-container>
                  </tbody>
                </table>
              </div>

              <!-- All other sections (composition, considerations, commercial terms, signature) -->
              <!-- Keep exactly as you have them -->
              <!-- ... (your existing sections) ... -->
                    <div class="composition-section">
        <!-- Section Title -->
        <div class="composition-intro"
            appQuotationEdit
            [quoteData]="quoteData"
            [quotationData]="quotationData"
            propertyPath="rawMaterialComposition.title">
          {{ quoteData?.rawMaterialComposition.title || 'Chemical Composition' }}
        </div>
    
        <!-- Loop through each material (e.g. GS 20 Mn5, CA6NM, etc.) -->
        <ng-container *ngFor="let material of quoteData?.rawMaterialComposition.materials; let matIndex = index">
          <div class="composition-table-wrapper" style="margin-top: 20px;">
    
            <table class="composition-table">
              <thead>
                <!-- Material Name Header (e.g. "GS 20 Mn5") -->
                <tr>
                  <th [attr.colspan]="material.elements.length"
                      class="material-type-header"
                      appQuotationEdit
                      [quoteData]="quoteData"
                      [quotationData]="quotationData"
                      [propertyPath]="'rawMaterialComposition.materials[' + matIndex + '].materialName'">
                    {{ material.materialName || 'Material Name' }}
                  </th>
                </tr>
    
                <!-- Element Names Row (C, Mn, P, S, etc.) -->
                <tr>
                  <th *ngFor="let el of material.elements; let elIndex = index"
                      appQuotationEdit
                      [quoteData]="quoteData"
                      [quotationData]="quotationData"
                      [propertyPath]="'rawMaterialComposition.materials[' + matIndex + '].elements[' + elIndex + '].element'">
                    {{ el.element || '-' }}
                  </th>
                </tr>
              </thead>
    
              <tbody>
                <!-- Range Values Row -->
                <tr>
                  <td class="data-cell"
                      *ngFor="let el of material.elements; let elIndex = index"
                      appQuotationEdit
                      [quoteData]="quoteData"
                      [quotationData]="quotationData"
                      [propertyPath]="'rawMaterialComposition.materials[' + matIndex + '].elements[' + elIndex + '].range'">
                    {{ el.range || '-' }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-container>
    
        <!-- Optional: Show empty table if no materials -->
        <ng-container *ngIf="!quoteData?.rawMaterialComposition.materials || quoteData.rawMaterialComposition.materials.length === 0">
          <div class="composition-table-wrapper" style="margin-top: 20px;">
            <table class="composition-table">
              <thead>
                <tr>
                  <th colspan="8" class="material-type-header"
                      appQuotationEdit
                      [quoteData]="quoteData"
                      [quotationData]="quotationData"
                      propertyPath="rawMaterialComposition.materials[0].materialName">
                    Material Grade
                  </th>
                </tr>
                <tr>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[0].element">C</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[1].element">Mn</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[2].element">P</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[3].element">S</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[4].element">Si</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[5].element">Cr</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[6].element">Ni</th>
                  <th appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[7].element">Mo</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[0].range">-</td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[1].range"> - </td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[2].range">-</td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[3].range">-</td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[4].range">-</td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[5].range">-</td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[6].range">-</td>
                  <td class="data-cell" appQuotationEdit [quoteData]="quoteData" [quotationData]="quotationData" propertyPath="rawMaterialComposition.materials[0].elements[7].range">-</td>
                </tr>
              </tbody>
            </table>
          </div>
        </ng-container>
      </div>
    
  
      <!-- General Considerations Section -->
      <div class="considerations-section" *ngIf="quoteData.generalConsiderations">
        <h3 class="section-title" [innerHTML]="boldBeforeColon(quoteData.generalConsiderations.title || 'General Considerations for Casting Development:')"></h3>
        <ol class="considerations-list">
          <ng-container *ngFor="let item of quoteData.generalConsiderations.items">
            <li *ngIf="item.isActive !== false">
              <div class="gc-title" [innerHTML]="boldBeforeColon(item.title + ':')" *ngIf="item.title"></div>
              <div class="gc-description" [innerHTML]="boldBeforeColon(item.description)" *ngIf="item.description"></div>
            </li>
          </ng-container>
        </ol>
      </div>
  
      <!-- Commercial Terms Section -->
      <div class="commercial-terms-section" *ngIf="quoteData.commercialTermsAndConditions">
        <h3 class="section-title" [innerHTML]="boldBeforeColon(quoteData.commercialTermsAndConditions.title || 'Commercial Terms & conditions')"></h3>
     
        <ol class="commercial-terms-list">
          <ng-container *ngFor="let section of quoteData.commercialTermsAndConditions.sections">
            <li *ngIf="section.isActive !== false" class="main-term">
              <div class="section-header">
                <div class="editable-title" [innerHTML]="boldBeforeColon(section.sectionTitle + ':')"></div>
              </div>
              <div class="section-items">
                <ng-container *ngFor="let item of section.items">
                  <!-- Normal text line -->
                  <div *ngIf="item.isActive !== false && item.text !== undefined && (!item.bulletPoints || item.bulletPoints.length === 0)" 
                       class="text-line"
                       [innerHTML]="boldBeforeColon(item.text)">
                  </div>
                  
                  <!-- Subheading -->
                  <div *ngIf="item.isActive !== false && item.subheading" class="subheading" [innerHTML]="boldBeforeColon(item.subheading)"></div>
                  
                  <!-- Bullet points -->
                  <div *ngIf="item.isActive !== false && item.bulletPoints && item.bulletPoints.length > 0" class="bullet-block">
                    <ul class="bullet-list">
                      <li *ngFor="let bullet of item.bulletPoints" 
                          class="bullet-item"
                          [innerHTML]="boldBeforeColon(bullet)">
                      </li>
                    </ul>
                  </div>
                </ng-container>
              </div>
            </li>
          </ng-container>
        </ol>
      </div>
  
      <!-- Concluding Paragraph -->
      <div class="concluding-paragraph">
        <p [innerHTML]="boldBeforeColon(quoteData.closingStatement || '')"></p>
      </div>

              <!-- Signature Block -->
              <div class="signature-block">
                <div class="signature-line" [innerHTML]="boldBeforeColon(quoteData.signature.thanks || '')"></div>
                <div class="signature-name" [innerHTML]="boldBeforeColon(quoteData.signature.name || '')"></div>
                <div class="signature-title" [innerHTML]="boldBeforeColon(quoteData.signature.designation || '')"></div>
                <div class="signature-department" [innerHTML]="boldBeforeColon(quoteData.signature.department || '')"></div>
              </div>
            </div>
          </div>
        </td>
      </tr>
    </tbody>

    <!-- Repeating Footer -->
    <tfoot>
      <tr>
        <td class="print-footer">
          <div class="contact-footer-fixed">
            <div class="contact-and-certification-section">
              <div class="contact-info">
                <div class="contact-text">
                  <span class="contact-link">
                    Address: {{ quoteData.contactInfo.address.value || '-' }},-,<br>
                  </span>
                  <span class="contact-link">
                    {{ quoteData.contactInfo.website.value || '-' }}
                  </span>
                </div>
              </div>
              <div class="certification-logos">
                <img src="assets/pdffooter.png" alt="Certification Logos" class="certification-image" id="certification-logo">
              </div>
            </div>
          </div>
        </td>
      </tr>
    </tfoot>
  </table>
</div>