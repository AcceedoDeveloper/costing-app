<div class="dashboard-container">
  <!-- Top Section: Total Quotations -->
  <div class="quotations-section">


    
    <div class="quotations-table-container">
      <div class="table-header">
        <h3 style="margin: 0;">Total Quotations</h3>
        <div class="header-filters">
          <select 
            class="status-filter-select"
            [(ngModel)]="selectedStatus" 
            (change)="onStatusChange()">
            <option *ngFor="let status of statusOptions" [value]="status">
              {{ status }}
            </option>
          </select>
          <div class="month-selector-wrapper">
            <button 
              type="button" 
              class="month-nav-button" 
              (click)="navigateToPreviousMonth()"
              title="Previous Month">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <input 
              type="month" 
              class="date-picker-input" 
              [value]="getMonthInputValue()" 
              (change)="onMonthInputChange($event)">
            <button 
              type="button" 
              class="month-nav-button" 
              (click)="navigateToNextMonth()"
              title="Next Month">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <div class="table-container">
          <table mat-table [dataSource]="quotationsDataSource" class="quotations-table">
          <!-- Customer Column -->
          <ng-container matColumnDef="customer">
            <th mat-header-cell *matHeaderCellDef>Customer</th>
            <td mat-cell (click)="openDifferenceGraph(row)" class="clickable-difference" *matCellDef="let row" class="customer-cell">{{ row.customer }}</td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell (click)="openDifferenceGraph(row)" class="clickable-difference" *matCellDef="let row">{{ row.email }}</td>
          </ng-container>

          <!-- Part Name Column -->
          <ng-container matColumnDef="partName">
            <th mat-header-cell *matHeaderCellDef>Part Name</th>
            <td mat-cell (click)="openDifferenceGraph(row)" class="clickable-difference" *matCellDef="let row">{{ row.partName }}</td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell (click)="openDifferenceGraph(row)" class="clickable-difference" *matCellDef="let row">
              <span class="status-badge" [ngClass]="getStatusClass(row.status)">{{ row.status }}</span>
            </td>
          </ng-container>

          <!-- Sent At Column -->
          <ng-container matColumnDef="sentAt">
            <th mat-header-cell *matHeaderCellDef>Sent At</th>
            <td mat-cell (click)="openDifferenceGraph(row)" class="clickable-difference" *matCellDef="let row">{{ row.sentAt }}</td>
          </ng-container>

          <!-- Actual Cost Column -->
          <ng-container matColumnDef="actualCost">
            <th mat-header-cell *matHeaderCellDef>Actual Cost</th>
            <td mat-cell  (click)="openDifferenceGraph(row)" class="clickable-difference" *matCellDef="let row">{{ row.actualCost | number }}</td>
          </ng-container>

          <!-- Difference Column -->
          <ng-container matColumnDef="difference">
            <th mat-header-cell *matHeaderCellDef>Difference</th>
            <td mat-cell *matCellDef="let row" 
                [ngClass]="row.difference >= 0 ? 'difference-cell positive' : 'difference-cell negative'"
                (click)="openDifferenceGraph(row)"
                class="clickable-difference">
              <span class="arrow" [ngClass]="row.difference >= 0 ? 'positive' : 'negative'">
                {{ row.difference >= 0 ? '↑' : '↓' }}
              </span> 
              {{ row.differenceAbs | number }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        </div>

        <mat-paginator 
          [pageSize]="pageSize" 
          [hidePageSize]="true"
          showFirstLastButtons>
        </mat-paginator>
      </div>
    </div>

    <!-- Total Quotations Summary Card -->
    <div class="quotations-summary-card">
      <div class="dashboard-section">

        <div class="section-title">Overall Quotation Data</div>
    
        <div class="quotation-container">
    
            <div class="q-card">
                <h2 class="totalQuotations" >{{ totalQuotations }}</h2>
                <p>Quotations</p>
                <span>100%</span>
            </div>
    
            <div class="q-card">
                <h2 class="approvedCount" >{{ approvedCount }}</h2>
                <p>Approved</p>
                <span>{{ approvedPercent }}%</span>
            </div>
    
            <div class="q-card">
                <h2 class="pendingCount" >{{ pendingCount }}</h2>
                <p>In Progress</p>
                <span>{{ pendingPercent }}%</span>
            </div>
    
               <div class="q-card">
                <h2 class="rejectedCount"  >{{ rejectedCount }}</h2>
                <p>Rejected</p>
                <span>{{ rejectedPercent }}%</span>
            </div>
    
        </div>
    
        <div class="section-title mt">Overall Cost Data</div>
    
        <div class="cost-container">
    
            <div class="cost-card">
                <p class="label">Profit</p>
              <div class="value-row" [ngClass]="totalProfit > 0 ? 'green' : ''">
        <span class="arrow" *ngIf="totalProfit > 0">▲</span>
        <span class="arrow" *ngIf="totalProfit <= 0">▼</span>
        <h2 class="value">{{ formatNumberInK(totalProfit) }}</h2>
        <span class="percent">{{ profitPercent }}%</span>
    </div>
    
            </div>
    
            <div class="cost-card">
                <p class="label">Losses</p>
                <div class="value-row" [ngClass]="totalLosses > 0 ? 'red' : ''">
        <span class="arrow">▼</span>
        <h2 class="value">{{ formatNumberInK(totalLosses) }}</h2>
        <span class="percent">{{ lossesPercent }}%</span>
    </div>
    
                
            </div>
    
            <div class="cost-card">
                <p class="label">Net Difference</p>
              <div class="value-row" [ngClass]="totalCostDifference >= 0 ? 'green' : 'red'">
        <span class="arrow" *ngIf="totalCostDifference >= 0">▲</span>
        <span class="arrow" *ngIf="totalCostDifference < 0">▼</span>
        <h2 class="value">{{ formatNumberInK(getAbsoluteValue(totalCostDifference)) }}</h2>
        <span class="percent">{{ getNetDifferencePercent() }}%</span>
    </div>
    
            </div>
    
        </div>
    </div>
    </div>
  </div>


</div>

