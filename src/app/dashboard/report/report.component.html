<div class="report-container">
  <!-- Header Section -->
  <div class="report-header">
    <div class="header-content">
      <div class="header-title">
        <mat-icon class="title-icon">assessment</mat-icon>
        <h1>Customer Details Report</h1>
      </div>
      <p class="header-subtitle">Comprehensive overview of all customer quotations and details</p>
    </div>

    <div class="content-actions">
      <button 
        class="view-toggle-btn" 
        [class.active]="viewMode === 'table'"
        (click)="switchToTableView()">
        <mat-icon>table_chart</mat-icon>
        <span>Table View</span>
      </button>
      <button 
        class="view-toggle-btn" 
        [class.active]="viewMode === 'grid'"
        (click)="switchToGridView()">
        <mat-icon>grid_view</mat-icon>
        <span>Grid View</span>
      </button>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card stat-card-primary">
      <div class="stat-icon-wrapper primary">
        <mat-icon>people</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalCustomers }}</div>
        <div class="stat-label">Total Records</div>
      </div>
      <div class="stat-trend">
        <mat-icon>trending_up</mat-icon>
      </div>
    </div>

    <div class="stat-card stat-card-success">
      <div class="stat-icon-wrapper success">
        <mat-icon>business</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ uniqueCustomers.size }}</div>
        <div class="stat-label">Unique Customers</div>
      </div>
      <div class="stat-trend">
        <mat-icon>trending_up</mat-icon>
      </div>
    </div>

  

    <div class="stat-card stat-card-success" 
         [class.stat-card-active]="selectedStatFilter === 'completed'"
         (click)="filterByStat('completed')"
         [style.cursor]="'pointer'">
      <div class="stat-icon-wrapper success">
        <mat-icon>done_all</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ completedCustomers }}</div>
        <div class="stat-label">Completed</div>
      </div>
      <div class="stat-trend">
        <mat-icon>trending_up</mat-icon>
      </div>
    </div>

    <div class="stat-card stat-card-warning"
         [class.stat-card-active]="selectedStatFilter === 'pending'"
         (click)="filterByStat('pending')"
         [style.cursor]="'pointer'">
      <div class="stat-icon-wrapper warning">
        <mat-icon>schedule</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ pendingCustomers }}</div>
        <div class="stat-label">Pending</div>
      </div>
      <div class="stat-trend">
        <mat-icon>trending_up</mat-icon>
      </div>
    </div>

    <div class="stat-card stat-card-info"
         [class.stat-card-active]="selectedStatFilter === 'modified'"
         (click)="filterByStat('modified')"
         [style.cursor]="'pointer'">
      <div class="stat-icon-wrapper info">
        <mat-icon>edit</mat-icon>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ modifiedCustomers }}</div>
        <div class="stat-label">Modified</div>
      </div>
      <div class="stat-trend">
        <mat-icon>trending_up</mat-icon>
      </div>
    </div>

    
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <!-- Date Filter Section -->
    <div class="date-filter-group">
      <div class="date-filter-type">
        <mat-icon class="date-icon">calendar_today</mat-icon>
        <select class="date-type-select" [(ngModel)]="dateFilterType" (ngModelChange)="onDateFilterTypeChange()">
          <option value="custom">Custom Range</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="year">This Year</option>
        </select>
      </div>
      <div class="date-range-inputs" *ngIf="dateFilterType === 'custom'">
        <input 
          type="date" 
          class="date-input" 
          [(ngModel)]="startDate"
          placeholder="Start Date">
        <span class="date-separator">to</span>
        <input 
          type="date" 
          class="date-input" 
          [(ngModel)]="endDate"
          placeholder="End Date">
      </div>
      <div class="date-range-inputs" *ngIf="dateFilterType === 'week'">
        <input 
          type="week" 
          class="date-input" 
          [(ngModel)]="selectedWeek"
          placeholder="Select Week">
      </div>
      <div class="date-range-inputs" *ngIf="dateFilterType === 'month'">
        <input 
          type="month" 
          class="date-input" 
          [(ngModel)]="selectedMonth"
          placeholder="Select Month">
      </div>
      <div class="date-range-inputs" *ngIf="dateFilterType === 'year'">
        <input 
          type="number" 
          class="date-input year-input" 
          [(ngModel)]="selectedYear"
          [placeholder]="'Year (e.g., ' + currentYear + ')'"
          min="2000"
          max="2100">
      </div>
      <div class="filter-actions">
        <button class="apply-filter-btn" (click)="applyFilter()" matTooltip="Apply Filters">
          <mat-icon>check</mat-icon>
          <span>Apply</span>
        </button>
        <button class="clear-filter-btn" (click)="clearFilter()" matTooltip="Clear All Filters">
          <mat-icon>clear</mat-icon>
          <span>Clear</span>
        </button>
      </div>
    </div>

    <div class="search-filter">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        class="search-input" 
        placeholder="Search by customer name, drawing number, or part name..."
        [(ngModel)]="searchText">
    </div>
    <!-- <div class="status-filter">
      <mat-icon class="filter-icon">filter_list</mat-icon>
      <select class="status-select" [(ngModel)]="selectedStatus">
        <option value="all">All Status</option>
        <option value="active">Active</option>
        <option value="pending">Pending</option>
        <option value="completed">Completed</option>
      </select>
    </div> -->
    <button  class="export-btn" (click)="exportToCSV()" matTooltip="Export to CSV">
      <mat-icon>download</mat-icon>
      <span>Export</span>
    </button>


    
  </div>




  <div>
    <!-- Customer Details Grid -->
    <div class="customers-grid" *ngIf="viewMode === 'grid' && filteredCustomers.length > 0; else noData">
      <div class="customer-card" *ngFor="let customer of filteredCustomers; trackBy: trackByCustomerId">
        <div class="card-header">
          <div class="customer-info">
            <div class="customer-avatar">
              <mat-icon>person</mat-icon>
            </div>
            <div class="customer-details">
              <h3 class="customer-name" [matTooltip]="customer.CustomerName?.name || 'N/A'">{{ getTruncatedCustomerName(customer) }}</h3>
              <p class="customer-id">ID: {{ customer.ID?.substring(0, 8) || 'N/A' }}</p>
            </div>
          </div>
          <div class="status-badge" [ngClass]="getStatusColor(customer.Status)">
            <mat-icon>{{ getStatusIcon(customer.Status) }}</mat-icon>
            <span>{{ customer.Status || 'N/A' }}</span>
          </div>
        </div>
  
        <div class="card-body">
          <div class="detail-row">
            <div class="detail-item">
              <mat-icon class="detail-icon">description</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Drawing No</span>
                <span class="detail-value">{{ customer.drawingNo || 'N/A' }}</span>
              </div>
            </div>
            <div class="detail-item">
              <mat-icon class="detail-icon">category</mat-icon>
              <div class="detail-content">
                <span class="detail-label">Part Name</span>
                <span class="detail-value">{{ customer.partName || 'N/A' }}</span>
              </div>
            </div>
          </div>
  
          <div class="process-section">
            <div class="process-header">
              <mat-icon>settings</mat-icon>
              <span>Processes ({{ getProcessCount(customer) }})</span>
            </div>
            <div class="process-tags" *ngIf="customer.processName && customer.processName.length > 0">
              <span class="process-tag" *ngFor="let process of customer.processName.slice(0, 3)">
                {{ process?.processName || process?.name || 'N/A' }}
              </span>
              <span class="process-tag more" *ngIf="customer.processName.length > 3">
                +{{ customer.processName.length - 3 }} more
              </span>
            </div>
            <div class="no-processes" *ngIf="!customer.processName || customer.processName.length === 0">
              No processes assigned
            </div>
          </div>
  
          <div class="inputs-section">
            <div class="input-badge" *ngIf="customer.Inputs?.castingInputs?.length">
              <mat-icon>inventory</mat-icon>
              <span>Casting</span>
            </div>
            <div class="input-badge" *ngIf="customer.Inputs?.mouldingInputs?.length">
              <mat-icon>precision_manufacturing</mat-icon>
              <span>Moulding</span>
            </div>
            <div class="input-badge" *ngIf="customer.Inputs?.coreInputs?.length">
              <mat-icon>build</mat-icon>
              <span>Core</span>
            </div>
          </div>
        </div>
  
        <div class="card-footer">
          <div class="footer-item">
            <mat-icon>calendar_today</mat-icon>
            <span>{{ customer.createdAt ? (customer.createdAt | date: 'short') : 'N/A' }}</span>
          </div>
          <div class="action-buttons">
            <button mat-icon-button class="action-btn view-btn" (click)="viewDetails(customer)" matTooltip="View Details">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button class="action-btn quote-btn" (click)="viewQuotationsreport(customer)" matTooltip="View Quotation">
              <mat-icon>description</mat-icon>
            </button>
            <button mat-icon-button class="action-btn download-btn" (click)="downloadQuotation(customer)" matTooltip="Download Quotation">
              <mat-icon>file_download</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Details Table -->
    <div class="table-container" *ngIf="viewMode === 'table' && filteredCustomers.length > 0">
      <table class="customer-table">
        <thead>
          <tr>
            <th>Customer Name</th>
            <th>Drawing No</th>
            <th>Part Name</th>
            <th>Status</th>
            <th>Processes</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let customer of filteredCustomers; trackBy: trackByCustomerId" class="table-row">
            <td>
              <div class="table-customer-info">
                <div class="table-customer-details">
                  <span class="table-customer-name" [title]="customer.CustomerName?.name || 'N/A'">
                    {{ customer.CustomerName?.name || 'N/A' }}
                  </span>
                  <span class="table-customer-id">ID: {{ customer.ID?.substring(0, 8) || 'N/A' }}</span>
                </div>
              </div>
            </td>
            <td>
              <div class="table-cell-content">
                <span>{{ customer.drawingNo || 'N/A' }}</span>
              </div>
            </td>
            <td>
              <div class="table-cell-content">
                <span>{{ customer.partName || 'N/A' }}</span>
              </div>
            </td>
            <td>
              <div class="status-badge-table" [ngClass]="getStatusColor(customer.Status)">
                <span>{{ customer.Status || 'N/A' }}</span>
              </div>
            </td>
            <td>
              <div class="table-processes">
                <span>{{ getProcessCount(customer) }}</span>
              </div>
            </td>
            <td>
              <div class="table-cell-content">
                <span>{{ customer.createdAt ? (customer.createdAt | date: 'short') : 'N/A' }}</span>
              </div>
            </td>
            <td>
              <div class="table-actions">
                <button mat-icon-button class="action-btn view-btn" (click)="viewDetails(customer)" matTooltip="View Details">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button class="action-btn quote-btn" (click)="viewQuotationsreport(customer)" matTooltip="View Quotation">
                  <mat-icon>description</mat-icon>
                </button>
                <button mat-icon-button class="action-btn download-btn" (click)="downloadQuotation(customer)" matTooltip="Download Quotation">
                  <mat-icon>file_download</mat-icon>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginator -->
    <div class="paginator-container" *ngIf="viewMode === 'table' && filteredCustomers.length > 0">
      <mat-paginator
        [length]="totalRecords"
        [pageSize]="pageLimit"
        [pageIndex]="currentPage - 1"
        [pageSizeOptions]="[10, 20, 50, 100]"
        [showFirstLastButtons]="true"
        (page)="onPageChange($event)"
        class="classy-paginator">
      </mat-paginator>
    </div>
  </div>


  <!-- No Data Template -->
  <ng-template #noData>
    <div class="no-data-container" *ngIf="filteredCustomers.length === 0">
      <mat-icon class="no-data-icon">inbox</mat-icon>
      <h3>No Customer Details Found</h3>
      <p *ngIf="searchText || selectedStatus !== 'all'">
        Try adjusting your search or filter criteria
      </p>
      <p *ngIf="!searchText && selectedStatus === 'all'">
        No customer details are available at the moment
      </p>
    </div>
  </ng-template>
</div>








