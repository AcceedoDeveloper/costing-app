<div class="user-management-update">
  <aside class="side-panel">
    <div class="panel-heading">
      <div class="icon-chip">
        <mat-icon>settings</mat-icon>
      </div>
      <div>
        <p class="eyebrow">USER MANAGEMENT</p>
        <h2>Update</h2>
      </div>
    </div>

    <nav class="panel-nav">
      <div
        class="nav-chip"
        *ngFor="let link of quickLinks"
        [attr.data-anchor]="link.anchor"
        [class.active]="link.anchor === activeAnchor"
        role="button"
        tabindex="0"
        (click)="scrollTo(link.anchor)"
        (keydown)="handleNavKey($event, link.anchor)">
        <span>{{ link.label }}</span>
        <mat-icon>chevron_right</mat-icon>
      </div>
      <div *ngIf="!isLoading && quickLinks.length === 0" style="padding: 16px; color: #94a3b8; text-align: center;">
        No versions yet
      </div>
    </nav>
    
  </aside>

  <section class="content">
    <header class="content-header">
      <div>
        <h1>Versions</h1>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="openCreateVersionDialog()">
          <mat-icon>add</mat-icon>
          Create
        </button>
      </div>
    </header>

    <div class="versions-scroll">
      <!-- Loading -->
      <div *ngIf="isLoading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading versions...</p>
      </div>

      <!-- Error -->
      <div *ngIf="errorMessage && !isLoading" class="error-state" style="padding: 40px; text-align: center; color: #ef4444;">
        <mat-icon>error_outline</mat-icon>
        <p>{{ errorMessage }}</p>
        <button mat-stroked-button (click)="loadVersions()">Retry</button>
      </div>

      <!-- No versions -->
      <div *ngIf="!isLoading && !errorMessage && versions.length === 0" class="empty-state" style="padding: 60px; text-align: center;">
        <mat-icon style="font-size: 64px; height: 64px;">folder_open</mat-icon>
        <p>No versions found.</p>
        <button mat-raised-button color="primary" (click)="openCreateVersionDialog()">
          Create First Version
        </button>
      </div>

      <!-- Versions list -->
      <div class="versions-grid" *ngIf="!isLoading && versions.length > 0">
        <article
          class="version-card"
          *ngFor="let version of versions; trackBy: trackById"
          [id]="'version-' + version._id"
          [class.active]="('version-' + version._id) === activeAnchor">

          <div class="card-header">
            <div>
              <h3>{{ version.heading || 'Untitled Version' }}</h3>
            </div>
            <div class="card-actions">
              <button mat-icon-button color="primary" (click)="openEditVersionDialog(version)" matTooltip="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteVersion(version._id)" matTooltip="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>

          <div class="version-comparison">
            <section class="version" *ngFor="let img of version.images; let i = index">
              <div class="version-label">
                <mat-icon>image</mat-icon>
                {{ img.label || 'Image ' + (i + 1) }}
              </div>

<div class="version-image"
     [ngClass]="{ 'has-image': img.image, 'clickable': img.image }"
     [style.background-image]="getBackgroundImage(img.image) || null"
     (click)="img.image && openLightbox(getImageUrl(img.image), img.label)"
     tabindex="0">
  <ng-container *ngIf="!img.image">
    <mat-icon>image</mat-icon>
    <span>No image</span>
  </ng-container>
</div>
            </section>
          </div>

          
        </article>
      </div>
    </div>
  </section>

  <!-- Lightbox -->
  <div class="image-lightbox" *ngIf="lightboxImage" (click)="closeLightbox()">
    <div class="lightbox-content" (click)="$event.stopPropagation()">
      <button mat-icon-button class="close-btn" (click)="closeLightbox()">
        <mat-icon>close</mat-icon>
      </button>
      <img [src]="lightboxImage.url" [alt]="lightboxImage.title" />
      <p>{{ lightboxImage.title }}</p>
    </div>
  </div>
</div>